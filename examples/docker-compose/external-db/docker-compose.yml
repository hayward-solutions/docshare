# Deployment with external PostgreSQL database
#
# For production, update FRONTEND_URL and BACKEND_URL to match your domain.
#
# Usage:
#   export DB_HOST=your-db-host
#   export DB_PASSWORD=your-db-password
#   export AWS_ACCESS_KEY_ID=your-key
#   export AWS_SECRET_ACCESS_KEY=your-secret
#   export S3_BUCKET=your-bucket
#   docker-compose up -d

services:
  gotenberg:
    image: gotenberg/gotenberg:8
    container_name: docshare-gotenberg
    command:
      - "gotenberg"
      - "--api-timeout=120s"
      - "--libreoffice-restart-after=10"

  backend:
    image: ghcr.io/hayward-solutions/docshare/backend:latest
    container_name: docshare-backend
    environment:
      DB_HOST: "${DB_HOST:-localhost}"
      DB_PORT: "${DB_PORT:-5432}"
      DB_USER: "${DB_USER:-docshare}"
      DB_PASSWORD: "${DB_PASSWORD}"
      DB_NAME: "${DB_NAME:-docshare}"
      DB_SSLMODE: "${DB_SSLMODE:-require}"
      S3_REGION: "${AWS_REGION:-us-east-1}"
      S3_ACCESS_KEY: "${AWS_ACCESS_KEY_ID:-}"
      S3_SECRET_KEY: "${AWS_SECRET_ACCESS_KEY:-}"
      S3_BUCKET: "${S3_BUCKET:-docshare}"
      JWT_SECRET: "${JWT_SECRET:-change-me-in-production}"
      GOTENBERG_URL: http://gotenberg:3000
      SERVER_PORT: 8080
      FRONTEND_URL: http://localhost:3001
      BACKEND_URL: http://localhost:8080/api
    ports:
      - "8080:8080"
    extra_hosts:
      - "host.docker.internal:host-gateway"

  frontend:
    image: ghcr.io/hayward-solutions/docshare/frontend:latest
    container_name: docshare-frontend
    ports:
      - "3001:3000"
    depends_on:
      - backend