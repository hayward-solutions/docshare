{{- if not .Values.api.existingSecret }}
{{- $secretName := include "docshare.secretName" . }}
{{- $existingSecret := lookup "v1" "Secret" .Release.Namespace $secretName }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  labels:
    {{- include "docshare.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
stringData:
  DB_PASSWORD: {{ ternary .Values.postgresql.auth.password .Values.externalDatabase.password .Values.postgresql.enabled | quote }}
  {{- if and .Values.s3.accessKey (ne .Values.s3.accessKey "") }}
  S3_ACCESS_KEY: {{ .Values.s3.accessKey | quote }}
  S3_SECRET_KEY: {{ .Values.s3.secretKey | quote }}
  {{- end }}
  {{- if and .Values.api.env.jwtSecret (ne .Values.api.env.jwtSecret "") }}
  JWT_SECRET: {{ .Values.api.env.jwtSecret | quote }}
  {{- else if and $existingSecret $existingSecret.data (index $existingSecret.data "JWT_SECRET") }}
  JWT_SECRET: {{ index $existingSecret.data "JWT_SECRET" | b64dec | quote }}
  {{- else }}
  JWT_SECRET: {{ randAlphaNum 64 | quote }}
  {{- end }}
{{- end }}
