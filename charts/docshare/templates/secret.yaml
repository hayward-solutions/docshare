{{- if not .Values.backend.existingSecret }}
{{- $secretName := include "docshare.secretName" . }}
{{- $existingSecret := lookup "v1" "Secret" .Release.Namespace $secretName }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  labels:
    {{- include "docshare.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
stringData:
  DB_PASSWORD: {{ ternary .Values.postgresql.auth.password .Values.externalDatabase.password .Values.postgresql.enabled | quote }}
  MINIO_ACCESS_KEY: {{ ternary .Values.minio.auth.rootUser .Values.externalMinio.accessKey .Values.minio.enabled | quote }}
  MINIO_SECRET_KEY: {{ ternary .Values.minio.auth.rootPassword .Values.externalMinio.secretKey .Values.minio.enabled | quote }}
  {{- if and .Values.backend.env.jwtSecret (ne .Values.backend.env.jwtSecret "") }}
  JWT_SECRET: {{ .Values.backend.env.jwtSecret | quote }}
  {{- else if and $existingSecret $existingSecret.data (index $existingSecret.data "JWT_SECRET") }}
  JWT_SECRET: {{ index $existingSecret.data "JWT_SECRET" | b64dec | quote }}
  {{- else }}
  JWT_SECRET: {{ randAlphaNum 64 | quote }}
  {{- end }}
{{- end }}
